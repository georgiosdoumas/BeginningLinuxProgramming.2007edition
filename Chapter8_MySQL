/* A variation of programm connect2.c , of pages 341-342 */
#include <stdlib.h>
#include <stdio.h>
#include "mysql.h"   
int main(int argc, char *argv[]) 
{
    MYSQL myconnection;
    mysql_init(&myconnection);
    /* My user is rick,the database he will connect to,on localhost,is practicedb ,we give wrong values to see erors */
    //if(mysql_real_connect(&myconnection, "localhst","rick","secret","practicedb", 0, NULL, 0) )
    //if(mysql_real_connect(&myconnection, "localhost","rock","secret","practicedb", 0, NULL, 0) ) 
    //if(mysql_real_connect(&myconnection, "localhost","rick","wrongpass","practicedb", 0, NULL, 0) ) 
    //if(mysql_real_connect(&myconnection, "localhost","rick","secret","nonexistingdb", 0, NULL, 0) )
    if(mysql_real_connect(&myconnection, "localhost","rick","secret","practicedb", 0, NULL, 0) )  /* all is correct here */
        { printf("Connection success\n"); mysql_close(&myconnection);} 
      else 
        { 
            fprintf(stderr,"Connection failed\n");
            if (mysql_errno(&myconnection) )
             {fprintf(stderr,"Connection error %d: %s\n",mysql_errno(&myconnection), mysql_error(&myconnection));}
        }
    return EXIT_SUCCESS;
}
/* 
I was able to compile it with the exact line that is given in the book on page 340 
gcc -I/usr/include/mysql connect2.c -L/usr/lib/mysql -lmysqlclient -o connect2 
I did it on a linux-Mint system
*/
/* Errors output that I get 
Connection error 2005: Unknown MySQL server host 'localhst' (0)
Connection error 1045: Access denied for user 'rock'@'localhost' (using password: YES)
Connection error 1045: Access denied for user 'rick'@'localhost' (using password: YES)
Connection error 1049: Unknown database 'nonexistingdb'
*/

-- create_children2.sql (a variation of page 339 )
-- Create the table children of database practicedb as per page 344 data
-- if you are in the directory where this sql program exists , connect to mysql and run so :
-- mysql> use practicedb
-- mysql> source create_children.sql 
--
DROP TABLE children;
CREATE TABLE children (
    childno int(11) AUTO_INCREMENT NOT NULL  PRIMARY KEY,
    fname varchar(30),
    age int(11)
);
--
-- Populate the table 'children' , no need to assign childno values , since they are auto-increment
-- insert the specific 11 rows 

INSERT INTO children( fname,age) VALUES ('Jenny',21);
INSERT INTO children( fname,age) VALUES ('Andrew',17);
INSERT INTO children( fname,age) VALUES ('Gavin',9);
INSERT INTO children( fname,age) VALUES ('Duncan',6);
INSERT INTO children( fname,age) VALUES ('Emma',4);
INSERT INTO children( fname,age) VALUES ('Alex',15);
INSERT INTO children( fname,age) VALUES ('Adrian',9);
INSERT INTO children( fname,age) VALUES ('Ann',3);
INSERT INTO children( fname,age) VALUES ('Ann',4);
INSERT INTO children( fname,age) VALUES ('Ann',3);
INSERT INTO children( fname,age) VALUES ('Ann',4);
-- end

//After running the above sql script , you can run the update1.c (hints for update.c are in page 344-345)
//Again the compile is done like this in an ubuntu/mint system :
//gcc -I/usr/include/mysql update1.c -L/usr/lib/mysql -lmysqlclient -o update1
#include <stdlib.h>
#include <stdio.h>
#include "mysql.h"   
int main(int argc, char *argv[]) 
{
    MYSQL my_connection;
    int res;
    mysql_init(&my_connection);
    if(mysql_real_connect(&my_connection, "localhost", "rick", "secret","practicedb", 0, NULL, CLIENT_FOUND_ROWS) )  
        { 
            printf("Connection success\n"); 
            res = mysql_query(&my_connection, "UPDATE children SET  AGE = 4 WHERE fname = 'Ann' ");
            if (!res) { printf("Updated %lu rows\n",(unsigned long)mysql_affected_rows(&my_connection)); }
            else { fprintf(stderr,"Insertion error %d: %s\n",mysql_errno(&my_connection),mysql_error(&my_connection)); }
            mysql_close(&my_connection);
        }
      else 
        {
            fprintf(stderr,"Connection failed\n");
            if (mysql_errno(&my_connection) )
             {fprintf(stderr,"Connection error %d: %s\n",mysql_errno(&my_connection), mysql_error(&my_connection));}   
         }
     return EXIT_SUCCESS;
}



// select2.c is not fully presented in the book , so I write it here with some modifications ,
// like to avoide the global declaration of MYSQL , MYSQL_RES , MYSQL_ROW , and to add 
// the mysql_errno(&my_connection) in the outputs 
// I also used a match criteria of name-text , not of age , to be sure that it works well
// page 351
#include <stdlib.h>
#include <stdio.h>
#include "mysql.h"
int main(int argc, char *argv[]) 
{
    MYSQL my_connection;  //The book had these 3 declared before main() , at global scope, which I find unneccesssary 
    MYSQL_RES *res_ptr;
    MYSQL_ROW sqlrow;
    int res;
    mysql_init(&my_connection);
    if (mysql_real_connect(&my_connection,"localhost","rick","secret","practicedb", 0, NULL, 0)) 
    {
        printf("Connection success\n");
        res = mysql_query(&my_connection,"SELECT childno, fname, age FROM children WHERE fname = 'Ann' ");
        /* by typing mistakenly something from the above line , eg childrenn , we can get various SELECT errors: */
        if (res) { printf("SELECT error %d: %s\n",mysql_errno(&my_connection), mysql_error(&my_connection)); }
        else
         { 
            res_ptr = mysql_use_result(&my_connection);
            if (res_ptr) 
             {
                while ((sqlrow = mysql_fetch_row(res_ptr))) 
                  { printf("Fetched data , one row at a time ...\n"); }
                if (mysql_errno(&my_connection)) 
                  { fprintf(stderr, "Retrive error %d: %s\n",mysql_errno(&my_connection), mysql_error(&my_connection)); }
                mysql_free_result(res_ptr);
             }
         }
        mysql_close(&my_connection);
     } 
    else 
     {
        fprintf(stderr, "Connection failed\n");
        if (mysql_errno(&my_connection)) 
         { fprintf(stderr,"Connection error %d: %s\n",mysql_errno(&my_connection), mysql_error(&my_connection)); }
     }
    return EXIT_SUCCESS;
}
// gcc -I/usr/include/mysql select2.c -L/usr/lib/mysql -lmysqlclient -o select2 
// For the practicedb of page 344-345 , I get 4 rows returned , which is correct



//select3.c is a variation of the book programm on pages 352-353 , where I follow the 
//avoidance of usage of global [outside main] variables. So I need to do some modifications
//on the declaration and definition and usage of function display_row 
// page 352-353 
#include <stdlib.h>
#include <stdio.h>
#include "mysql.h"
void display_row(MYSQL * some_connection_ptr , MYSQL_ROW dbrow);
int main() 
{
    MYSQL my_connection;
    MYSQL_RES *res_ptr;
    MYSQL_ROW sqlrow;
    int res;
    mysql_init(&my_connection);
    if (mysql_real_connect(&my_connection,"localhost","rick","secret","practicedb", 0, NULL, 0)) 
    {
        printf("Connection success\n");
        res = mysql_query(&my_connection,"SELECT childno, fname, age FROM children WHERE fname = 'Ann' ");
        /* by typing mistakenly something from the above line , eg childrenn , we can get various SELECT error: */
        if (res) { printf("SELECT error %d: %s\n",mysql_errno(&my_connection), mysql_error(&my_connection)); }
        else
         { 
            res_ptr = mysql_use_result(&my_connection);
            if (res_ptr) 
             {
                while ((sqlrow = mysql_fetch_row(res_ptr))) 
                   { 
                    printf("Fetched data , one row at a time ...\n"); 
                    display_row(&my_connection , sqlrow ); 
                   }
                if (mysql_errno(&my_connection)) 
                  { fprintf(stderr, "Retrive error %d: %s\n",mysql_errno(&my_connection), mysql_error(&my_connection)); }
                mysql_free_result(res_ptr);
             }
         }
        mysql_close(&my_connection);
     } 
    else 
     {
        fprintf(stderr, "Connection failed\n");
        if (mysql_errno(&my_connection)) 
         { fprintf(stderr,"Connection error %d: %s\n",mysql_errno(&my_connection), mysql_error(&my_connection)); }
     }
    return EXIT_SUCCESS;
}
void display_row(MYSQL * some_connection_ptr , MYSQL_ROW dbrow)
{
    unsigned int field_count;  /* number of columns */
    field_count = 0;
    while ( field_count < mysql_field_count(some_connection_ptr) ) 
     {
        printf("%s ", dbrow[field_count]);
        field_count++;
     }
    printf("\n");
}
// gcc -I/usr/include/mysql select3.c -L/usr/lib/mysql -lmysqlclient -o select3 
// For the practicedb of page 344-345 , I get 4 rows returned , which is correct
